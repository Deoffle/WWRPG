module.exports=[86034,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(66516);function f({campaignId:a,monsterId:d,currentUrl:f,onUploaded:g}){let h=(0,e.createSupabaseBrowserClient)(),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);async function m(b){let c;if(l(null),!b.type.startsWith("image/"))return void l("Please choose an image file.");if(b.size>5242880)return void l("Image too large (max 5MB).");let e=(c=b.name.toLowerCase().split(".")).length>1?c.pop():"image/png"===b.type?"png":"image/webp"===b.type?"webp":"jpg",f=`${a}/${d}/cover.${e}`;j(!0);let{error:i}=await h.storage.from("monsters").upload(f,b,{upsert:!0,contentType:b.type});if(i){j(!1),l(i.message);return}let{data:k}=h.storage.from("monsters").getPublicUrl(f);j(!1),g(k.publicUrl)}return(0,b.jsxs)("div",{className:"space-y-2",children:[f?(0,b.jsx)("img",{src:f,alt:"Monster",className:"w-full max-h-[240px] object-contain rounded-lg border bg-white"}):(0,b.jsx)("div",{className:"w-full h-40 rounded-lg border flex items-center justify-center text-sm text-gray-600",children:"No image yet"}),(0,b.jsx)("input",{type:"file",accept:"image/*",disabled:i,onChange:a=>{let b=a.target.files?.[0];b&&m(b),a.currentTarget.value=""}}),i&&(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Uploading…"}),k&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:k})]})}function g(a,b){return("string"==typeof a?a:"").slice(0,b)}function h({title:a,value:c,disabled:d,onChange:e}){let f=(Array.isArray(c)?c:[]).map(a=>({name:g(a?.name,120),text:g(a?.text,2e3)}));function h(a,b){e(f.map((c,d)=>d===a?{...c,...b}:c))}return(0,b.jsxs)("div",{className:"border rounded-lg p-3 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"font-medium",children:a}),(0,b.jsx)("button",{className:"border rounded-md px-3 py-2",type:"button",disabled:d,onClick:function(){e([...f,{name:"",text:""}])},children:"Add"})]}),0===f.length&&(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"None yet."}),(0,b.jsx)("div",{className:"space-y-3",children:f.map((a,c)=>(0,b.jsxs)("div",{className:"border rounded-md p-3 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",placeholder:"Name",value:a.name,disabled:d,onChange:a=>h(c,{name:a.target.value})}),(0,b.jsx)("button",{className:"border rounded-md px-3 py-2 text-red-600",type:"button",disabled:d,onClick:()=>{e(f.filter((a,b)=>b!==c))},children:"Remove"})]}),(0,b.jsx)("textarea",{className:"border rounded-md p-2 w-full",rows:3,placeholder:"Rules text",value:a.text,disabled:d,onChange:a=>h(c,{text:a.target.value})})]},c))})]})}let i={PHY:10,MEN:10,MAG:10,INT:10,DIP:10,ICY:10};function j(a){let b=Number(a);return Number.isFinite(b)?b:0}function k(a,b){return a.split(",").map(a=>a.trim()).filter(a=>a.length>0).slice(0,b)}function l(a){return Array.isArray(a)?a.map(a=>({name:"string"==typeof a?.name?a.name:"",text:"string"==typeof a?.text?a.text:""})).filter(a=>a.name.trim()||a.text.trim()):[]}function m({campaignId:a,monster:e,characters:g}){let m=(0,d.useRouter)(),n=(0,c.useMemo)(()=>{let a=e.data??{},b=a.sheet??{},c=Array.isArray(b.resistances)?b.resistances:Array.isArray(a.resistances)?a.resistances:[],d=Array.isArray(b.immunities)?b.immunities:Array.isArray(a.immunities)?a.immunities:[];return{name:e.name??"Monster",tags:(e.tags??[]).join(", "),imageUrl:a.imageUrl??"",type:a.type??"",size:a.size??"",alignment:a.alignment??"",ac:a.ac??"",hp:a.hp??"",speed:a.speed??"",strengths:Array.isArray(a.strengths)?a.strengths.join(", "):"",weaknesses:Array.isArray(a.weaknesses)?a.weaknesses.join(", "):"",resistances:Array.isArray(c)?c.join(", "):"",immunities:Array.isArray(d)?d.join(", "):"",senses:a.senses??"",languages:a.languages??"",gm_notes:e.gm_notes??"",stats:{...i,...a.stats??{}},description:"string"==typeof b.description?b.description:"",traits:l(b.traits),actions:l(b.actions),reactions:l(b.reactions),legendary_actions:l(b.legendary_actions)}},[e]),[o,p]=(0,c.useState)(n),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!0),[A,B]=(0,c.useState)(g[0]?.id??""),[C,D]=(0,c.useState)("Unsorted"),[E,F]=(0,c.useState)("1");async function G(b){t(null),v(null),r(!0);let c=await fetch("/api/monsters/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,monsterId:e.id,patch:b})}),d=await c.json().catch(()=>({}));return(r(!1),c.ok)?(v("Saved."),m.refresh(),!0):(t(d?.error??"Failed to save monster."),!1)}async function H(){let a=o.name.trim();if(!a)return t("Name cannot be empty.");let b=k(o.tags,20),c=k(o.strengths,50),d=k(o.weaknesses,50),f=k(o.resistances,50),g=k(o.immunities,50),h={...e.data??{},imageUrl:o.imageUrl||null,type:o.type,size:o.size,alignment:o.alignment,ac:""===o.ac?null:j(String(o.ac)),hp:""===o.hp?null:j(String(o.hp)),speed:o.speed,strengths:c,weaknesses:d,senses:o.senses,languages:o.languages,stats:{PHY:j(String(o.stats.PHY)),MEN:j(String(o.stats.MEN)),MAG:j(String(o.stats.MAG)),INT:j(String(o.stats.INT)),DIP:j(String(o.stats.DIP)),ICY:j(String(o.stats.ICY))},sheet:{...e.data?.sheet??{},description:o.description??"",resistances:f,immunities:g,traits:o.traits??[],actions:o.actions??[],reactions:o.reactions??[],legendary_actions:o.legendary_actions??[]}};await G({name:a,tags:b,gm_notes:o.gm_notes,data:h})}async function I(){if(!confirm("Delete this monster? This cannot be undone."))return;t(null),r(!0);let b=await fetch("/api/monsters/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,monsterId:e.id})}),c=await b.json().catch(()=>({}));(r(!1),b.ok)?(m.push(`/app/c/${a}/monsters`),m.refresh()):t(c?.error??"Failed to delete monster.")}async function J(){t(null),v(null);let b=Number(E);if(![1,2,3].includes(b))return t("Reveal level must be 1, 2, or 3.");if(!w&&!A)return t("Pick a character (or push to all).");r(!0);let c=await fetch("/api/bestiary/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,monsterId:e.id,characterId:w?null:A,category:C,revealLevel:b,allCharacters:w,skipNpc:y})}),d=await c.json().catch(()=>({}));(r(!1),c.ok)?v(w?`Pushed to bestiary (${d?.count??"?"} characters).`:"Pushed to bestiary."):t(d?.error??"Failed to push to bestiary.")}return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("section",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsx)("h2",{className:"font-medium",children:"Monster sheet"}),s&&(0,b.jsx)("p",{className:"text-sm text-red-600",children:s}),u&&(0,b.jsx)("p",{className:"text-sm text-green-700",children:u}),(0,b.jsxs)("div",{className:"grid gap-2 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Name"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.name,onChange:a=>p(b=>({...b,name:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Tags (comma-separated)"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.tags,onChange:a=>p(b=>({...b,tags:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"sm:col-span-2 border rounded-lg p-3 space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Image"}),(0,b.jsx)(f,{campaignId:a,monsterId:e.id,currentUrl:o.imageUrl,onUploaded:async a=>{p(b=>({...b,imageUrl:a}));let b={...e.data??{},imageUrl:a};await G({data:b})}}),(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"Uploading saves automatically."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Type"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.type,onChange:a=>p(b=>({...b,type:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Size"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.size,onChange:a=>p(b=>({...b,size:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Alignment"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.alignment,onChange:a=>p(b=>({...b,alignment:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"AC"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:String(o.ac),onChange:a=>p(b=>({...b,ac:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"HP"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:String(o.hp),onChange:a=>p(b=>({...b,hp:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1 sm:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Speed"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.speed,onChange:a=>p(b=>({...b,speed:a.target.value})),disabled:q})]})]}),(0,b.jsxs)("div",{className:"border rounded-lg p-3 space-y-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Stats"}),(0,b.jsx)("div",{className:"grid gap-2 grid-cols-2 sm:grid-cols-6",children:["PHY","MEN","MAG","INT","DIP","ICY"].map(a=>(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:a}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:String(o.stats[a]),onChange:b=>p(c=>({...c,stats:{...c.stats,[a]:b.target.value}})),disabled:q})]},a))})]}),(0,b.jsxs)("div",{className:"grid gap-2 sm:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Strengths (comma-separated)"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.strengths,onChange:a=>p(b=>({...b,strengths:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Weaknesses (comma-separated)"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.weaknesses,onChange:a=>p(b=>({...b,weaknesses:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Resistances (comma-separated)"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.resistances,onChange:a=>p(b=>({...b,resistances:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Immunities (comma-separated)"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.immunities,onChange:a=>p(b=>({...b,immunities:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Senses"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.senses,onChange:a=>p(b=>({...b,senses:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Languages"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:o.languages,onChange:a=>p(b=>({...b,languages:a.target.value})),disabled:q})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Description"}),(0,b.jsx)("textarea",{className:"border rounded-md p-2 w-full",rows:4,value:o.description,onChange:a=>p(b=>({...b,description:a.target.value})),disabled:q})]}),(0,b.jsx)(h,{title:"Traits",value:o.traits,disabled:q,onChange:a=>p(b=>({...b,traits:a}))}),(0,b.jsx)(h,{title:"Actions",value:o.actions,disabled:q,onChange:a=>p(b=>({...b,actions:a}))}),(0,b.jsx)(h,{title:"Reactions",value:o.reactions,disabled:q,onChange:a=>p(b=>({...b,reactions:a}))}),(0,b.jsx)(h,{title:"Legendary actions",value:o.legendary_actions,disabled:q,onChange:a=>p(b=>({...b,legendary_actions:a}))}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"GM notes"}),(0,b.jsx)("textarea",{className:"border rounded-md p-2 w-full",rows:3,value:o.gm_notes,onChange:a=>p(b=>({...b,gm_notes:a.target.value})),disabled:q})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{className:"border rounded-md px-3 py-2",type:"button",disabled:q,onClick:H,children:q?"Saving…":"Save"}),(0,b.jsx)("button",{className:"border rounded-md px-3 py-2 text-red-600",type:"button",disabled:q,onClick:I,children:"Delete"})]})]}),(0,b.jsxs)("section",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsx)("h2",{className:"font-medium",children:"Push to character bestiary"}),(0,b.jsxs)("div",{className:"grid gap-3 sm:grid-cols-2",children:[(0,b.jsxs)("label",{className:"border rounded-lg p-3 flex items-start gap-3",children:[(0,b.jsx)("input",{type:"checkbox",className:"mt-1",checked:w,onChange:a=>x(a.target.checked),disabled:q}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"Push to all characters"}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Sends/updates this creature for every character in the campaign."})]})]}),(0,b.jsxs)("label",{className:"border rounded-lg p-3 flex items-start gap-3",children:[(0,b.jsx)("input",{type:"checkbox",className:"mt-1",checked:y,onChange:a=>z(a.target.checked),disabled:q||!w}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"Skip NPC characters"}),(0,b.jsxs)("div",{className:"text-xs text-gray-600",children:["When pushing to all, ignores characters where ",(0,b.jsx)("code",{children:"characters.sheet.isNpc"})," is true."]})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-2 sm:grid-cols-3 items-start",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Character"}),(0,b.jsxs)("select",{className:"border rounded-md p-2 w-full",value:A,onChange:a=>B(a.target.value),disabled:q||w,children:[(0,b.jsx)("option",{value:"",children:"Select character…"}),g.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),w&&(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Disabled because “Push to all characters” is enabled."})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Category"}),(0,b.jsx)("input",{className:"border rounded-md p-2 w-full",value:C,onChange:a=>D(a.target.value),disabled:q}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2",children:[(0,b.jsx)("button",{type:"button",className:"border rounded-md px-3 py-1 text-sm",disabled:q,onClick:()=>D("Creatures"),children:"Creatures"}),(0,b.jsx)("button",{type:"button",className:"border rounded-md px-3 py-1 text-sm",disabled:q,onClick:()=>D("Humanoids"),children:"Humanoids"})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Reveal level"}),(0,b.jsxs)("select",{className:"border rounded-md p-2 w-full",value:E,onChange:a=>F(a.target.value),disabled:q,children:[(0,b.jsx)("option",{value:"1",children:"1 — Image only"}),(0,b.jsx)("option",{value:"2",children:"2 — Image + strengths/weaknesses"}),(0,b.jsx)("option",{value:"3",children:"3 — Full sheet"})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,b.jsx)("button",{type:"button",className:"border rounded-md px-3 py-1 text-sm",disabled:q,onClick:()=>F("1"),children:"L1"}),(0,b.jsx)("button",{type:"button",className:"border rounded-md px-3 py-1 text-sm",disabled:q,onClick:()=>F("2"),children:"L2"}),(0,b.jsx)("button",{type:"button",className:"border rounded-md px-3 py-1 text-sm",disabled:q,onClick:()=>F("3"),children:"L3"})]})]})]}),(0,b.jsx)("button",{className:"border rounded-md px-3 py-2",type:"button",disabled:q,onClick:J,children:q?"Pushing…":w?"Push / Update all":"Push / Update"}),(0,b.jsx)("p",{className:"text-xs text-gray-600",children:"This writes a redacted snapshot into the character’s bestiary entry (based on reveal level)."})]})]})}a.s(["default",()=>m],86034)}];

//# sourceMappingURL=src_app_app_c_%5BcampaignId%5D_monsters_%5BmonsterId%5D_monster-editor_tsx_24e574b2._.js.map