module.exports=[66018,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(66516),f=a.i(7957);function g({campaignId:a}){let{state:d,setValue:e,flushSave:g}=(0,f.useCampaignQuestLog)(a,{canEdit:!0}),h=(0,c.useRef)(null);return(0,c.useEffect)(()=>(h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{g(d.value)},600),()=>clearTimeout(h.current)),[d.value,g]),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-medium",children:"Quest log"}),(0,b.jsx)("div",{className:"text-[11px] text-gray-500",children:d.isLoading?"Loading…":d.isSaving?"Saving…":d.lastSavedAt?"Saved":""})]}),d.error?(0,b.jsx)("div",{className:"text-xs text-red-600 break-words",children:d.error}):null,(0,b.jsx)("textarea",{className:"w-full min-h-[260px] resize-y rounded-xl border p-2 text-sm",value:d.value,onChange:a=>e(a.target.value),placeholder:"Write the shared quest log here…"})]})}function h({campaignId:a}){let[d,e]=(0,c.useState)("quest");return(0,b.jsx)("aside",{className:"w-full lg:w-[420px] shrink-0",children:(0,b.jsxs)("div",{className:"border rounded-2xl p-3 lg:sticky lg:top-6 max-h-[calc(100vh-3rem)] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("div",{className:"font-medium",children:"Reference"}),(0,b.jsx)("div",{className:"text-[11px] text-gray-500",children:"DM tools"})]}),(0,b.jsx)("div",{className:"mt-2 grid grid-cols-1 gap-2",children:(0,b.jsx)(i,{active:"quest"===d,onClick:()=>e("quest"),children:"Quest log"})}),(0,b.jsx)("div",{className:"mt-3 border rounded-xl p-3 overflow-y-auto max-h-[calc(100vh-10rem)]",children:"quest"===d?(0,b.jsx)(g,{campaignId:a}):null})]})})}function i({active:a,onClick:c,children:d}){return(0,b.jsx)("button",{type:"button",onClick:c,className:`px-3 py-2 rounded-xl border text-sm ${a?"bg-black text-white border-black":"hover:bg-gray-50"}`,children:d})}function j({campaignId:a}){let f=(0,c.useMemo)(()=>(0,e.createSupabaseBrowserClient)(),[]),[g,i]=(0,c.useState)(!0),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)({}),[x,y]=(0,c.useState)({}),[z,A]=(0,c.useState)({}),[B,C]=(0,c.useState)({}),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)({}),[H,I]=(0,c.useState)({}),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(null),T=l?.active_encounter_id??null,U=n?.turn_index??0,V=p.filter(a=>!a.is_defeated),W=V[U],X=W?.character_id??null,[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)("Enemy"),[aa,ab]=(0,c.useState)(!1),[ac,ad]=(0,c.useState)([]),[ae,af]=(0,c.useState)(""),[ag,ah]=(0,c.useState)("all");if((0,c.useEffect)(()=>{K(!1)},[T]),!a)return(0,b.jsxs)("div",{style:{padding:16},children:[(0,b.jsx)("h1",{children:"DM Screen"}),(0,b.jsx)("div",{children:(0,b.jsx)(d.default,{href:"/app",children:"← Back to campaign"})}),(0,b.jsxs)("div",{style:{padding:12,border:"1px solid #f99",background:"#fee"},children:[(0,b.jsx)("b",{children:"Error:"})," campaignId is missing from the URL params.",(0,b.jsxs)("div",{style:{marginTop:8},children:["This usually means your folder is named ",(0,b.jsx)("code",{children:"[campaignid]"})," but the code expects"," ",(0,b.jsx)("code",{children:"[campaignId]"}),"."]})]})]});async function ai(){i(!0),k(null);let{data:b,error:c}=await f.from("campaign_state").select("campaign_id, mode, active_encounter_id").eq("campaign_id",a).maybeSingle();if(c){k(c.message),i(!1);return}m(b??{campaign_id:a,mode:"exploration",active_encounter_id:null});let{data:d,error:e}=await f.from("characters").select("id, name").eq("campaign_id",a).order("created_at",{ascending:!0});if(e){k(e.message),i(!1);return}if(s(d??[]),!t&&(d?.length??0)>0&&u(d[0].id),b?.active_encounter_id){let c=b.active_encounter_id,{data:d,error:e}=await f.from("encounters").select("id, status, round_number, turn_index").eq("id",c).single();if(e){k(e.message),i(!1);return}o(d);let{data:g,error:h}=await f.from("encounter_log").select("id, created_at, kind, visibility, payload").eq("campaign_id",a).eq("encounter_id",c).order("created_at",{ascending:!1}).limit(50);if(h){k(h.message),i(!1);return}ad(g??[]);let{data:j,error:l}=await f.from("encounter_combatants").select("id, kind, name, character_id, order_index, is_hidden, is_defeated, status_public, death_saves_successes, death_saves_failures").eq("campaign_id",a).eq("encounter_id",c).order("order_index",{ascending:!0,nullsFirst:!1}).order("created_at",{ascending:!0});if(l){k(l.message),i(!1);return}q(j??[]);let m={},n={};(j??[]).forEach(a=>{m[a.id]=String(a.death_saves_successes??0),n[a.id]=String(a.death_saves_failures??0)}),G(m),I(n);let p=(j??[]).map(a=>a.id),{data:r,error:s}=await f.from("encounter_combatants_private").select("combatant_id, initiative, hp_current, hp_max").in("combatant_id",p);if(s){k(s.message),i(!1);return}let t={};(j??[]).forEach(a=>{let b=(r??[]).find(b=>b.combatant_id===a.id);t[a.id]=String(b?.initiative??0)}),w(t);let u={},v={};(j??[]).forEach(a=>{let b=(r??[]).find(b=>b.combatant_id===a.id);u[a.id]=String(b?.hp_current??1),v[a.id]=String(b?.hp_max??1)}),y(u),A(v)}else o(null),q([]),ad([]);i(!1)}async function aj(b){M(b),O(null),S(null),Q(!0);let{data:c,error:d}=await f.from("cards").select("id,name,rules_text,image_path,structured").eq("id",b).eq("campaign_id",a).maybeSingle();if(d||!c){S(d?.message??"Card not found"),Q(!1);return}let e=function(a){if(a&&"object"==typeof a)return a;if("string"==typeof a)try{let b=JSON.parse(a);return b&&"object"==typeof b?b:{}}catch{}return{}}(c.structured),g="string"==typeof c.image_path?c.image_path:null,h="string"==typeof e?.image_path?e.image_path:null,i=g??h,j=i?f.storage.from("card-images").getPublicUrl(i).data?.publicUrl??null:null;O({...c,imageUrl:j}),Q(!1)}async function ak(b){let{data:c,error:d}=await f.from("encounter_log").select("id, created_at, kind, visibility, payload").eq("campaign_id",a).eq("encounter_id",b).order("created_at",{ascending:!1}).limit(50);d||ad(c??[])}async function al(b){k(null);let c=await fetch("/api/encounter/dm/combatant/set-death-saves",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,combatantId:b,successes:F[b],failures:H[b]})}),d=await c.json().catch(()=>({}));c.ok?await ai():k(d?.error??"Failed to update death saves")}async function am(){k(null);let b=await fetch("/api/encounter/dm/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a})}),c=await b.json();b.ok?await ai():k(c?.error??"Failed to start combat")}async function an(){if(k(null),!J){Z("Arm “End combat” first."),setTimeout(()=>Z(null),2500);return}let b=await fetch("/api/encounter/dm/end",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a})}),c=await b.json();b.ok?(K(!1),await ai()):k(c?.error??"Failed to end combat")}async function ao(){if(k(null),!T)return void k("No active encounter. Start combat first.");let b=await fetch("/api/encounter/dm/enemy/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,name:$,isHidden:aa})}),c=await b.json();b.ok?await ai():k(c?.error??"Failed to add enemy")}async function ap(b){if(k(null),!T)return;let c=await fetch("/api/encounter/dm/undo-last-action",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,characterId:b})}),d=await c.json().catch(()=>({}));c.ok?(Z("Undid last action."),setTimeout(()=>Z(null),2e3),await ai()):k(d?.error??"Undo failed")}async function aq(){if(k(null),!T)return void k("No active encounter. Start combat first.");if(!t)return void k("Select a character first.");let b=await fetch("/api/encounter/dm/character/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,characterId:t})}),c=await b.json();b.ok?(c?.alreadyExists&&Z("Character already in encounter."),setTimeout(()=>Z(null),3e3),await ai()):k(c?.error??"Failed to add character")}async function ar(){if(k(null),!T)return void k("No active encounter. Start combat first.");let b=await fetch("/api/encounter/dm/turn/next",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T})}),c=await b.json();b.ok?await ai():k(c?.error??"Failed to advance turn")}async function as(b,c){if(k(null),!T)return void k("No active encounter. Start combat first.");let d=await fetch("/api/encounter/dm/combatant/toggle-defeated",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,combatantId:b,isDefeated:c})}),e=await d.json();d.ok?await ai():k(e?.error??"Failed to update defeated")}async function at(b,c){k(null);let d=await fetch("/api/encounter/dm/combatant/toggle-hidden",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,combatantId:b,isHidden:c})}),e=await d.json();d.ok?await ai():k(e?.error??"Failed to update hidden")}async function au(){if(k(null),!T)return void k("No active encounter.");let b=ae.trim();if(!b)return;let c=await fetch("/api/encounter/dm/log/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,visibility:ag,text:b})}),d=await c.json().catch(()=>({}));c.ok?(af(""),await ai()):k(d?.error??"Failed to add log note")}async function av(b){if(k(null),!T)return void k("No active encounter. Start combat first.");let c=v[b],d=await fetch("/api/encounter/dm/combatant/set-initiative",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,encounterId:T,combatantId:b,initiative:c})}),e=await d.json();d.ok?await ai():k(e?.error??"Failed to update initiative")}async function aw(b){k(null);let c=await fetch("/api/encounter/dm/combatant/set-hp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,combatantId:b,hpCurrent:x[b],hpMax:z[b]})}),d=await c.json();c.ok?await ai():k(d?.error??"Failed to update HP")}function ax(a){return Array.isArray(a)?a.map(a=>{if("string"==typeof a)return{label:a,remaining:1};if(a&&"object"==typeof a){let b=String(a.label??"").trim(),c=Number(a.remaining);return b?{label:b,remaining:Number.isFinite(c)?c:1}:null}return null}).filter(Boolean):[]}async function ay(b){k(null);let c=(B[b]??"").trim(),d=Number(D[b]??"1");if(!c)return void k("Status label cannot be empty.");let e=await fetch("/api/encounter/dm/combatant/status/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,combatantId:b,label:c,duration:d})}),f=await e.json();e.ok?(C(a=>({...a,[b]:""})),E(a=>({...a,[b]:"1"})),await ai()):k(f?.error??"Failed to add status")}async function az(b,c){k(null);let d=await fetch("/api/encounter/dm/combatant/status/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaignId:a,combatantId:b,label:c})}),e=await d.json();d.ok?await ai():k(e?.error??"Failed to remove status")}return(0,c.useEffect)(()=>{ai()},[a]),(0,c.useEffect)(()=>{if(!a)return;let b=f.channel(`dm-${a}`).on("postgres_changes",{event:"*",schema:"public",table:"campaign_state",filter:`campaign_id=eq.${a}`},a=>{console.log("[dm realtime campaign_state]",a),ai()}).on("postgres_changes",{event:"*",schema:"public",table:"encounters",filter:`campaign_id=eq.${a}`},()=>ai()).on("postgres_changes",{event:"*",schema:"public",table:"encounter_combatants",filter:`campaign_id=eq.${a}`},()=>ai()).on("postgres_changes",{event:"*",schema:"public",table:"encounter_combatants_private"},()=>ai()).on("postgres_changes",{event:"*",schema:"public",table:"encounter_log"},a=>{console.log("[dm realtime encounter_log]",a),ai()}).subscribe(a=>{console.log("[dm realtime status]",a)}),c=setInterval(()=>{T&&ak(T)},2e3);return()=>{clearInterval(c),f.removeChannel(b)}},[a,T]),(0,b.jsx)("main",{className:"p-6 pb-24",children:(0,b.jsxs)("div",{className:"max-w-6xl lg:flex gap-4",children:[(0,b.jsxs)("section",{className:"flex-1 space-y-6 min-w-0",children:[(0,b.jsxs)("header",{className:"space-y-1",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"DM Screen"}),(0,b.jsx)(d.default,{className:"underline text-sm",href:`/app/c/${a}`,children:"← Back to campaign"}),j?(0,b.jsxs)("p",{className:"text-sm text-red-600",children:["Error: ",j]}):null,Y?(0,b.jsx)("p",{className:"text-sm text-red-600",children:Y}):null,(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:"Campaign:"})," ",a]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:"Mode:"})," ",l?.mode??"unknown"]})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap pt-2",children:[(0,b.jsx)("button",{onClick:ai,disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Reload"}),T?(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:J,onChange:a=>K(a.target.checked)}),(0,b.jsx)("span",{className:"font-medium",children:"Arm “End combat”"})]}),(0,b.jsx)("button",{onClick:an,disabled:g||!J,className:"px-3 py-2 rounded-lg border bg-black text-white hover:opacity-90 disabled:opacity-50",title:J?"End combat":"Enable the toggle to avoid accidental clicks",children:"End Combat (Back to Exploration)"})]}):(0,b.jsx)("button",{onClick:am,disabled:g,className:"px-3 py-2 rounded-lg border bg-black text-white hover:opacity-90 disabled:opacity-50",children:"Start Combat"})]})]}),T?(0,b.jsxs)("section",{className:"border rounded-xl p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Active encounter:"})," ",T]}),(0,b.jsxs)("div",{className:"flex gap-4 flex-wrap text-sm text-gray-600",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:"Round:"})," ",n?.round_number??"?"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:"Turn index:"})," ",n?.turn_index??"?"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-800",children:"Status:"})," ",n?.status??"?"]})]}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap pt-2",children:[(0,b.jsx)("button",{onClick:ar,disabled:g,className:"px-3 py-2 rounded-lg border bg-black text-white hover:opacity-90 disabled:opacity-50",children:"Next Turn"}),(0,b.jsx)("button",{onClick:()=>{if(!X){Z("No current player character to undo."),setTimeout(()=>Z(null),2e3);return}ap(X)},disabled:g||!X,className:"px-3 py-2 rounded-lg border border-red-300 text-red-700 hover:bg-red-50 disabled:opacity-50",title:X?"Undo last draw/play/discard for the current player":"Current combatant is not a player character",children:"Undo last action"})]})]}),(0,b.jsxs)("div",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsx)("h2",{className:"font-medium",children:"Add enemy"}),(0,b.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,b.jsx)("input",{value:$,onChange:a=>_(a.target.value),placeholder:"Enemy name",className:"px-3 py-2 border rounded-lg w-64"}),(0,b.jsxs)("label",{className:"flex gap-2 items-center text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:aa,onChange:a=>ab(a.target.checked)}),"Start hidden"]}),(0,b.jsx)("button",{onClick:ao,disabled:g,className:"px-3 py-2 rounded-lg border bg-black text-white hover:opacity-90 disabled:opacity-50",children:"Add Enemy"})]}),(0,b.jsxs)("div",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsx)("h2",{className:"font-medium",children:"Add character"}),0===r.length?(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"No characters found in this campaign."}):(0,b.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,b.jsx)("select",{value:t,onChange:a=>u(a.target.value),className:"px-3 py-2 border rounded-lg",children:r.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name??a.id},a.id))}),(0,b.jsx)("button",{onClick:aq,disabled:g,className:"px-3 py-2 rounded-lg border bg-black text-white hover:opacity-90 disabled:opacity-50",children:"Add Character"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("h2",{className:"font-medium",children:["Combatants (",p.length,")"]}),0===p.length?(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"No combatants yet."}):(0,b.jsx)("ul",{className:"space-y-2",children:p.map(a=>{let c=V.findIndex(b=>b.id===a.id),d=c===U&&-1!==c;return(0,b.jsx)("li",{className:`border rounded-lg p-3 ${d?"border-yellow-300":""} ${a.is_defeated?"opacity-60":""}`,children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium",children:[d?"⭐ ":"",a.name??"(no name)"]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["kind: ",a.kind," · hidden: ",String(a.is_hidden)," · defeated:"," ",String(a.is_defeated)]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Initiative"}),(0,b.jsx)("input",{value:v[a.id]??"0",onChange:b=>w(c=>({...c,[a.id]:b.target.value})),className:"px-2 py-1 border rounded-md w-20",inputMode:"numeric"}),(0,b.jsx)("button",{onClick:()=>av(a.id),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Save"})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,b.jsx)("button",{onClick:()=>as(a.id,!a.is_defeated),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:a.is_defeated?"Undo Defeated":"Mark Defeated"}),"enemy"===a.kind||"npc"===a.kind?(0,b.jsx)("button",{onClick:()=>at(a.id,!a.is_hidden),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:a.is_hidden?"Reveal":"Hide"}):null]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Statuses"}),(0,b.jsx)("div",{className:"flex gap-2 flex-wrap",children:0===ax(a.status_public).length?(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"None"}):ax(a.status_public).map(c=>(0,b.jsxs)("span",{className:"inline-flex items-center gap-2 border rounded-full px-3 py-1 text-sm",children:[(0,b.jsxs)("span",{children:[c.label," (",c.remaining,")"]}),(0,b.jsx)("button",{onClick:()=>az(a.id,c.label),disabled:g,className:"text-sm underline disabled:opacity-50",title:"Remove",children:"x"})]},c.label))}),(0,b.jsxs)("div",{className:"flex gap-2 items-center flex-wrap",children:[(0,b.jsx)("input",{value:B[a.id]??"",onChange:b=>C(c=>({...c,[a.id]:b.target.value})),placeholder:"e.g. stunned",className:"px-3 py-2 border rounded-lg w-56"}),(0,b.jsx)("input",{value:D[a.id]??"1",onChange:b=>E(c=>({...c,[a.id]:b.target.value})),placeholder:"turns",className:"px-3 py-2 border rounded-lg w-24",inputMode:"numeric"}),(0,b.jsx)("button",{onClick:()=>ay(a.id),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Add"})]})]}),"enemy"===a.kind||"npc"===a.kind?(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"HP"}),(0,b.jsx)("input",{value:x[a.id]??"1",onChange:b=>y(c=>({...c,[a.id]:b.target.value})),className:"px-2 py-1 border rounded-md w-20",inputMode:"numeric",placeholder:"cur"}),(0,b.jsx)("span",{className:"text-sm text-gray-500",children:"/"}),(0,b.jsx)("input",{value:z[a.id]??"1",onChange:b=>A(c=>({...c,[a.id]:b.target.value})),className:"px-2 py-1 border rounded-md w-20",inputMode:"numeric",placeholder:"max"}),(0,b.jsx)("button",{onClick:()=>aw(a.id),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Save HP"})]}):(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Player HP is controlled by the player."}),"character"===a.kind?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-xs text-gray-600",children:"Death saves"}),(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Success"}),(0,b.jsxs)("select",{className:"px-2 py-1 border rounded-md",value:F[a.id]??"0",onChange:b=>G(c=>({...c,[a.id]:b.target.value})),children:[(0,b.jsx)("option",{value:"0",children:"0"}),(0,b.jsx)("option",{value:"1",children:"1"}),(0,b.jsx)("option",{value:"2",children:"2"}),(0,b.jsx)("option",{value:"3",children:"3"})]}),(0,b.jsx)("label",{className:"text-xs text-gray-600",children:"Fail"}),(0,b.jsxs)("select",{className:"px-2 py-1 border rounded-md",value:H[a.id]??"0",onChange:b=>I(c=>({...c,[a.id]:b.target.value})),children:[(0,b.jsx)("option",{value:"0",children:"0"}),(0,b.jsx)("option",{value:"1",children:"1"}),(0,b.jsx)("option",{value:"2",children:"2"}),(0,b.jsx)("option",{value:"3",children:"3"})]}),(0,b.jsx)("button",{onClick:()=>al(a.id),disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Save"})]})]}):null]})]})},a.id)})})]}),(0,b.jsxs)("section",{className:"border rounded-xl p-4 space-y-3",children:[(0,b.jsx)("h2",{className:"font-medium",children:"Encounter log"}),(0,b.jsxs)("div",{className:"flex gap-2 flex-wrap items-center",children:[(0,b.jsxs)("select",{value:ag,onChange:a=>ah("dm"===a.target.value?"dm":"all"),className:"px-3 py-2 rounded-lg border",children:[(0,b.jsx)("option",{value:"all",children:"Public"}),(0,b.jsx)("option",{value:"dm",children:"DM only"})]}),(0,b.jsx)("input",{value:ae,onChange:a=>af(a.target.value),placeholder:"Write a note...",className:"px-3 py-2 rounded-lg border flex-1 min-w-[240px]"}),(0,b.jsx)("button",{type:"button",onClick:au,disabled:g,className:"px-3 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50",children:"Add note"})]}),0===ac.length?(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"No log entries yet."}):(0,b.jsx)("ul",{className:"space-y-2",children:ac.map(a=>{let c=a.payload??{},d="";if("note"===a.kind)d=String(c.text??"");else if("card"===a.kind){let a=c.action,b=c.card_name??"(card)",e=c.character_name??"Someone";d=`${e} ${"play"===a?"played":"discarded"} ${b}`}else d=`${a.kind??"log"} entry`;let e="card"===a.kind,f=c?.action,g=c?.character_name??"Someone",h=c?.card_name??"(card)",i="string"==typeof c?.card_id?c.card_id:"";return(0,b.jsx)("li",{className:"text-sm",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[(0,b.jsx)("div",{children:e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("span",{children:[g," "]}),(0,b.jsxs)("span",{children:["play"===f?"played":"discarded"," "]}),(0,b.jsx)("button",{type:"button",className:"underline",onClick:()=>{i&&aj(i)},children:h})]}):(0,b.jsx)(b.Fragment,{children:d})}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:["dm"===a.visibility?"DM":"Public"," ·"," ",new Date(a.created_at).toLocaleString()]})]})},a.id)})})]})]}):(0,b.jsx)("section",{className:"border rounded-xl p-4 space-y-2",children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"No active encounter."})}),L&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4",onClick:()=>{M(null),O(null),S(null)},children:(0,b.jsxs)("div",{className:"bg-white text-black w-full max-w-3xl rounded-2xl p-4 space-y-3",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xl font-semibold",children:N?.name??(P?"Loading…":"Card")}),R?(0,b.jsx)("div",{className:"text-sm text-red-600",children:R}):null]}),(0,b.jsx)("button",{className:"border rounded-md px-3 py-2",onClick:()=>{M(null),O(null),S(null)},children:"Close"})]}),P?(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Loading…"}):N?(0,b.jsxs)(b.Fragment,{children:[N.imageUrl?(0,b.jsx)("img",{src:N.imageUrl,alt:N.name??"Card",className:"w-full max-h-[420px] object-contain rounded-lg border bg-white"}):(0,b.jsx)("div",{className:"w-full h-[220px] rounded-lg border bg-gray-50 grid place-items-center text-sm text-gray-500",children:"No image"}),(0,b.jsx)("div",{className:"max-h-[45vh] overflow-y-auto pr-1",children:(0,b.jsx)("div",{className:"text-sm whitespace-pre-wrap text-gray-800",children:N.rules_text??""})})]}):null]})})]}),(0,b.jsx)(h,{campaignId:a})]})})}a.s(["default",()=>j],66018)}];

//# sourceMappingURL=src_app_app_c_%5BcampaignId%5D_dm_dm-client_tsx_a3235c61._.js.map